---
import { SITE_CONFIG } from '@/lib/constants';

interface Props {
  type: 'LocalBusiness' | 'Organization';
  location?: {
    kecamatan: string;
    provinsi: string;
    provinsiSlug: string;
    slug: string;
    coordinates?: { lat: number; lng: number };
  };
  breadcrumbs?: Array<{ name: string; url: string }>;
}

const { type, location, breadcrumbs } = Astro.props;

// Get current path info for breadcrumb
const currentPath = Astro.url.pathname;
const isDaftarPage = currentPath.includes('/daftar-promotor-stifin/');
const isPendaftaranPage = currentPath.includes('/pendaftaran-promotor-stifin/');

// LocalBusiness Schema (Enhanced)
const localBusinessSchema = location ? {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": `Promotor STIFIn ${location.kecamatan}`,
  "description": `Peluang bisnis sebagai Licensed Promotor STIFIn Genetic Test di ${location.kecamatan}, ${location.provinsi}. 6 sumber penghasilan, margin minimal 300%.`,
  "url": Astro.url.href,
  "telephone": `+${SITE_CONFIG.whatsapp.number}`,
  "email": SITE_CONFIG.email,
  "address": {
    "@type": "PostalAddress",
    "addressLocality": location.kecamatan,
    "addressRegion": location.provinsi,
    "addressCountry": "ID"
  },
  ...(location.coordinates && {
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": location.coordinates.lat,
      "longitude": location.coordinates.lng
    }
  }),
  "openingHours": "Mo-Su 09:00-21:00",
  "priceRange": "$$",
  "areaServed": {
    "@type": "GeoCircle",
    "geoMidpoint": {
      "@type": "GeoCoordinates",
      "latitude": location.coordinates?.lat || 0,
      "longitude": location.coordinates?.lng || 0
    },
    "geoRadius": "50000"
  },
  "offers": {
    "@type": "Offer",
    "description": "Peluang bisnis Licensed Promotor STIFIn dengan 6 sumber penghasilan, margin minimal 300%",
    "priceCurrency": "IDR"
  }
} : null;

// Organization Schema (Enhanced)
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": SITE_CONFIG.name,
  "url": SITE_CONFIG.url,
  "logo": {
    "@type": "ImageObject",
    "url": `${SITE_CONFIG.url}/favicon.svg`,
    "width": "512",
    "height": "512"
  },
  "description": SITE_CONFIG.description,
  "foundingDate": "2024",
  "areaServed": {
    "@type": "Country",
    "name": "Indonesia"
  },
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": `+${SITE_CONFIG.whatsapp.number}`,
    "contactType": "Customer Service",
    "availableLanguage": ["Indonesian"],
    "areaServed": "ID",
    "contactOption": "TollFree",
    "availableLanguage": "id"
  },
  "sameAs": [
    SITE_CONFIG.social.facebook,
    SITE_CONFIG.social.instagram,
    SITE_CONFIG.social.twitter,
  ]
};

// Build Breadcrumb Schema based on current page
let breadcrumbItems = [
  {
    "@type": "ListItem",
    "position": 1,
    "name": "Home",
    "item": SITE_CONFIG.url
  }
];

// Add breadcrumb items for location pages (3-level structure)
if (location && (isDaftarPage || isPendaftaranPage)) {
  const baseKeyword = isDaftarPage ? 'Daftar Promotor STIFIn' : 'Pendaftaran Promotor STIFIn';
  const baseUrl = isDaftarPage ? '/daftar-promotor-stifin' : '/pendaftaran-promotor-stifin';

  // Level 2: Category/Keyword
  breadcrumbItems.push({
    "@type": "ListItem",
    "position": 2,
    "name": baseKeyword,
    "item": `${SITE_CONFIG.url}${baseUrl}`
  });

  // Level 3: Province
  breadcrumbItems.push({
    "@type": "ListItem",
    "position": 3,
    "name": location.provinsi,
    "item": `${SITE_CONFIG.url}${baseUrl}/${location.provinsiSlug}`
  });

  // Level 4: City (current page)
  breadcrumbItems.push({
    "@type": "ListItem",
    "position": 4,
    "name": location.kecamatan,
    "item": Astro.url.href
  });
} else if (breadcrumbs && breadcrumbs.length > 0) {
  // Custom breadcrumbs passed as prop
  breadcrumbs.forEach((crumb, index) => {
    breadcrumbItems.push({
      "@type": "ListItem",
      "position": index + 2,
      "name": crumb.name,
      "item": crumb.url
    });
  });
}

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbItems
};

// FAQ Schema for location pages
const faqSchema = location ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": `Berapa penghasilan yang didapat Licensed Promotor STIFIn di ${location.kecamatan}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Licensed Promotor STIFIn memiliki 6 sumber penghasilan dengan margin minimal 300% dari modal voucher tes. Potensi penghasilan >10 juta per bulan bahkan bisa >3x UMR DKI Jakarta."
      }
    },
    {
      "@type": "Question",
      "name": "Apakah ada biaya untuk menjadi promotor STIFIn?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Ya, ada investasi awal untuk mengikuti Workshop STIFIn Level 1, Level 2, dan mendapatkan ID Aplikasi. Ini adalah investasi sekali seumur hidup untuk mendapatkan lisensi resmi."
      }
    },
    {
      "@type": "Question",
      "name": "Apa saja benefit menjadi Licensed Promotor STIFIn?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Benefit meliputi: 6 sumber penghasilan (tes, private, speaker, 3 afiliasi), margin minimal 300%, ID Aplikasi seumur hidup, support marketing lengkap, dan potensi penghasilan >10 juta/bulan."
      }
    },
    {
      "@type": "Question",
      "name": `Bagaimana cara mendaftar promotor STIFIn di ${location.kecamatan}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `Anda bisa mendaftar langsung melalui WhatsApp di nomor ${SITE_CONFIG.whatsapp.displayNumber}. Tim kami akan membantu proses pendaftaran dan memberikan panduan lengkap.`
      }
    }
  ]
} : null;

const mainSchema = type === 'LocalBusiness' && localBusinessSchema
  ? localBusinessSchema
  : organizationSchema;
---

<!-- Main Schema (Organization or LocalBusiness) -->
<script type="application/ld+json" set:html={JSON.stringify(mainSchema)} />

<!-- Breadcrumb Schema -->
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

<!-- FAQ Schema for location pages -->
{faqSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
)}
